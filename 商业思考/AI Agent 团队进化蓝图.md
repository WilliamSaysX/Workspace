# AI Agent 团队进化蓝图

## 1. 目标

本文档旨在为现有 Agent 团队，规划一条从“导演模式”迈向“自动化融合架构”的清晰进化路径。核心目标是融合 CrewAI 的流程编排能力和 Claude Code 的智能执行能力，构建一个更高效、更自动化的 AI 研发体系。

---

## 2. 核心架构：高速公路 + 特种部队模型

未来的融合架构由两个核心组件构成，它们分别解决不同类型的问题，并通过精巧的机制协同工作。

### 2.1 CrewAI：自动化流程的“高速公路”

*   **定位**：确定性流程的自动化控制器。
*   **核心能力**：
    *   **流程编排 (Orchestration)**：通过代码化的 `Agent`, `Task`, `Crew` 体系，将标准研发流程固化为自动化生产线。
    *   **上下文管道 (Context Pipelining)**：通过 `Task` 的 `context` 参数，将上游任务的**纯净产出**精准地**注入**到下游任务的提示词中，实现了上下文的自动净化与传递，避免了信息污染。
    *   **并行处理 (Parallel Execution)**：通过 `Process.hierarchical` 模式，设立“主管Agent”，实现对多个下游任务的并行调度与管理。
*   **解决问题**：解决“导演模式”的效率瓶颈，将重复、流程化的工作彻底自动化，并能高效处理并行任务。

### 2.2 Claude Code：解决复杂问题的“特种部队”

*   **定位**：非确定性任务的专家攻坚小组。
*   **核心能力**：**智能调度 (Delegation)**。利用其“子代理军团”机制，自主理解高阶目标，协同内部专家完成复杂的、探索性的任务。
*   **解决问题**：解决自动化流程中遇到的、无法通过标准化步骤解决的疑难杂症，如复杂Bug修复、大规模代码重构等。

---

## 3. 进化路线图

### 阶段一：现状 - 导演模式下的文件总线协作

*   **架构**：人类导演通过 Trae 驱动独立的专家 Agent，以标准化的文件目录作为通信和状态管理总线。每个 Agent 在独立的会话中工作，由导演手动完成上下文的“净化”与传递。
*   **评估**：该模式已成功验证了专家 Agent 协同工作的价值，并建立了稳定的流程基础。主要瓶颈在于人力驱动的效率限制和无法并行处理。

### 阶段二：下一阶段 - 分层自动化架构 (引入 CrewAI)

*   **行动计划**：
    1.  **流程代码化**：将《产品研发Agent团队协作指南》中定义的角色、任务和协作顺序，用 CrewAI 的 `Agent`, `Task`, `Crew` 进行代码化实现。
    2.  **构建分层主干工作流**：
        *   创建一个顶层的 `main_production_crew`。
        *   对于需要并行的阶段（如设计完成后，多客户端同时开发），采用 `Process.hierarchical` 模式。设立一个 `CTOAgent` 作为主管，其任务是“协调所有客户端团队的开发工作”。`CTOAgent` 将自动把任务分解并并行委派给 `WebClientAgent`, `MobileClientAgent` 等。
    3.  **实现上下文管道**：在定义 `Task` 依赖时，大量使用 `context=[upstream_task]` 参数，确保上游任务的产出（如PRD文档）能被精准、纯净地传递给下游任务。
    4.  **达成目标**：实现核心研发流程的高度自动化和并行化，将人类角色从“导演”提升为“总设计师”。

### 阶段三：最终形态 - 智能融合架构 (集成 Claude Code)

*   **行动计划**：
    1.  **工具化封装**：在 CrewAI 中，将 Claude Code 封装为一个可被调用的自定义工具（`ClaudeCodeTool`）。
    2.  **建立分诊节点**：在主干工作流的测试环节后，增加一个 `TriageTask`（分诊任务）。
    3.  **实现分诊与调度逻辑**：由 `TriageAgent` 执行此任务，分析 Bug 报告。对于复杂、非确定性的 Bug，**调用 `ClaudeCodeTool`**，并将 Bug 的详细描述作为高阶任务传给 Claude Code。
    4.  **形成反馈闭环**：`ClaudeCodeTool` 执行完毕后，其结果返回给 CrewAI 工作流，自动进行回归测试。

---

## 4. 架构终局：具备自愈能力的 AI 研发体系

*   **角色定位**：人类成为“总指挥”，负责设计、监督和优化整个 AI 研发体系。
*   **系统能力**：
    *   **稳定生产 (高速公路)**：通过 CrewAI 自动化、并行化地执行日常产品迭代。
    *   **智能攻坚 (特种部队)**：通过 Claude Code 解决流程中出现的、意外的复杂难题。
*   **核心价值**：构建一个集稳定生产与智能修复于一体的、可持续进化的、高度自动化的 AI 研发体系。 