# Claude Code 从入门到精通手册

本手册旨在帮助你从零开始，逐步掌握 Anthropic 出品的强大终端编码助手 Claude Code，并最终达到能够对其进行扩展和集成的精通水平。

---

## 第一部分：初识 Claude Code (入门)

### 1.1 什么是 Claude Code？

Claude Code 是一个智能编码助手，它直接集成在你的终端（Terminal）中。与传统的 AI 编程工具不同，它能够深入理解你的整个代码库，并通过自然语言指令帮助你更快地编写、修改和理解代码。你可以把它想象成一位资深的技术专家，就坐在你的命令行里，随时待命。

### 1.2 为什么选择 Claude Code？

*   **终端原生，无缝集成**: 无需切换窗口或IDE，所有操作都在你最熟悉的终端环境中完成。
*   **深度代码库感知**: 无需手动选择和喂给它上下文文件，Claude Code 会像一个真正的开发者一样，主动探索和理解你的整个项目结构和依赖关系。
*   **强大的行动能力**: 它不只是能生成代码片段，还能直接执行修改文件、运行测试、操作 Git、创建提交和发起 Pull Request 等实际操作。

---

## 第二部分：快速上手 (入门)

### 2.1 系统要求

*   **操作系统**: macOS 10.15+, Ubuntu 20.04+/Debian 10+, 或通过 WSL 的 Windows。
*   **软件**: Node.js 18+。
*   **可选**: `git` 2.23+, GitHub CLI (`gh`) 或 GitLab CLI (`glab`)。

### 2.2 安装

Claude Code 通过 npm 进行全局安装。打开你的终端，运行以下命令：

```bash
npm install -g @anthropic-ai/claude-code
```

### 2.3 首次启动与项目初始化

1.  **进入你的项目目录**: `cd /path/to/your/project`
2.  **启动 Claude Code**: `claude`
3.  **让 Claude 认识你的项目**: `> 给我这个代码库的概述`
4.  **生成项目指南 (推荐)**: `/init`

---

## 第三部分：交互模式与命令参考 (核心)

这是掌握 Claude Code 日常使用的关键。

### 3.1 两种工作模式

1.  **交互模式**: 运行 `claude` 启动，进行连续对话。
2.  **一次性命令模式**: `claude "你的指令"`，执行完后立即退出。

### 3.2 内置命令 (Slash Commands) 详解

*   **/help**: 显示帮助信息。
*   **/clear**: 清空当前会话上下文。
*   **/edit <文件路径>...**: 手动将文件加入上下文。
*   **/find <关键词>**: 在代码库中进行语义搜索。
*   **/init**: 生成 `CLAUDE.md` 项目指南。
*   **/ls [目录路径]**: 列出目录内容。
*   **/query <查询语句>**: 对代码库执行一次性语义查询。
*   **/run <命令>**: 执行一个 shell 命令并让 Claude 看到输出。
*   **/test [测试名称或文件]**: 运行指定测试。
*   **/toggle <设置项>**: 切换 `auto-edit` (自动修改) 或 `tools` (使用外部工具) 等开关。
*   **/undo**: 撤销上一次文件修改。
*   **/quit** 或 **/exit**: 退出。

---

## 第四部分：核心技能 (实践)

组合使用自然语言和斜杠命令，完成日常开发任务。

### 4.1 深入理解代码库

```
> 给我这个代码库的概述
> /find database models
> /edit src/models/user.ts src/models/order.ts
> 解释这两个模型之间的关系
```

### 4.2 高效修复与重构

```
> 我遇到了一个 bug，这是复现步骤：...
> /run npm test
> [Claude 提出修改方案]
> 应用这个修改
> /run npm test
```

### 4.3 自动化工作流

```
> 检查当前的分支状态
> 提交我的更改，提交信息是 "feat: Add user profile page"
> 创建一个 PR
```

---

## 第五部分：架构与扩展 (精通)

**欢迎来到“精通”的世界。** 这一部分将揭示 Claude Code 强大的底层机制，让你能真正地驾驭、扩展和集成它。

### 5.1 核心架构：模型上下文协议 (MCP)

模型上下文协议（Model Context Protocol, MCP）是 Claude Code 的核心所在。它定义了一套标准的、机器可读的格式，用来将外部工具、文件内容、命令输出等信息“喂”给大语言模型。

你可以把 MCP 想象成专为 AI 设计的 `man` 手册页。当你运行 `/run git status` 时，Claude Code 内部会将 `git status` 的输出包装成一个 MCP 格式的“工具使用结果”，然后将其与你的指令一起发送给 Claude 模型。这样，模型就能准确理解“我刚刚运行了 git status，这是结果”。

**为什么这很重要？** 理解 MCP 意味着你可以创建自己的工具，让 Claude Code 拥有全新的能力。

### 5.2 Claude Code SDK

SDK 是你扩展 Claude Code 能力的主要武器。它允许你用代码定义自己的工具，并让 Claude Code 能够调用它们。

**使用场景**：假设你公司的项目需要一个特殊的部署命令 `corp-deploy`。你可以使用 SDK 创建一个新工具：

1.  **定义工具**: 创建一个工具定义文件，描述 `corp-deploy` 命令的参数和作用。
2.  **实现逻辑**: 编写工具的执行代码，调用公司的部署脚本。
3.  **注册工具**: 让 Claude Code 加载你的自定义工具。

完成之后，你就可以在 Claude Code 中直接使用自然语言操作了：
`> 把最新的修改部署到测试环境`
Claude Code 会理解你的意图，并调用你通过 SDK 创建的 `corp-deploy` 工具来完成操作。

### 5.3 子代理 (Child Agents)

这是 Claude Code 最强大的概念之一。当面对一个复杂的任务（例如“给这个项目添加 OAuth 登录功能”）时，主 Agent 可以派生出多个专门的“子代理”来协同工作。

*   一个**文件检索子代理**负责查找所有与身份验证相关的文件。
*   一个**代码编写子代理**负责修改找到的文件，添加新的逻辑。
*   一个**测试子代理**负责创建并运行新的测试用例。

它们并行工作，并将结果汇报给主 Agent，由主 Agent 整合并最终呈现给你。作为高级用户，你可以通过 SDK 设计和编排更复杂的子代理协作流程，实现真正的“AI团队”自动化。

### 5.4 钩子 (Hooks)

钩子允许你在 Claude Code 执行生命周期的特定点注入你自己的逻辑。

*   **pre-execution hook**: 在模型执行任何操作（如修改文件、运行命令）**之前**触发。你可以用它来进行权限检查、日志记录或修改即将执行的命令。
*   **post-execution hook**: 在操作完成**之后**触发。你可以用它来发送通知（如部署成功后发一个 Slack 消息）、清理临时文件或分析执行结果。

### 5.5 Claude Code GitHub Actions

这使你能够将 Claude Code 的能力集成到你的 CI/CD 工作流中。

**使用场景**：

*   **自动修复测试**: 当 GitHub Actions 中的测试失败时，自动触发一个 Claude Code Action。它会读取错误日志，尝试修复代码，然后再次运行测试。
*   **代码审查助理**: 当有新的 PR 被创建时，触发 Claude Code Action。它可以检查代码是否符合团队规范，是否有潜在的 bug，并自动发表评论。

---

## 第六部分：故障排除 (必备)

*   **问题：认证失败/API 密钥错误**
    *   **解决方案**: 确保你的 Anthropic API 密钥已正确配置为环境变量，或通过 Claude Code 的认证流程重新登录。

*   **问题：上下文长度超出限制**
    *   **解决方案**: 使用 `/clear` 命令开启一个新会话。对于大文件，不要一次性全部用 `/edit` 加载，先用 `/find` 或 `/query` 让 Claude Code 定位到关键部分，再有选择性地编辑。

*   **问题：Claude Code 拒绝执行一个看起来很安全的命令**
    *   **解决方案**: 这是它的安全机制。你可以尝试将命令拆解得更简单，或者先让它解释它看到了什么顾虑，然后针对性地打消它的顾虑。

*   **问题：`/undo` 不起作用**
    *   **解决方案**: `/undo` 只能撤销由 Claude Code 直接进行的文件修改。如果你通过 `/run` 执行了一个外部命令（如 `rm -f *`），它是无法撤销的。请谨慎使用 `/run`。

---

## 第七部分：总结与最佳实践

*   **入门**: 学会用自然语言提问。
*   **核心**: 熟练组合使用自然语言和斜杠命令，尤其是 `/run`, `/edit`, `/find`。
*   **精通**: 开始思考如何用 **SDK** 为你的团队构建专属工具，如何用 **GitHub Actions** 将其能力注入自动化流程，这才是 Claude Code 的最终形态——一个可编程的、可扩展的开发基础设施。

现在，你已经拥有了从入门到精通的完整地图。去构建你的 AI 编程新范式吧！ 